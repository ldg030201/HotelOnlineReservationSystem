<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tuk.hors.room.service.impl.RoomDAO">
    <select id="selectRoomList" resultType="com.tuk.hors.room.DTO.RoomDTO">
        SELECT
            ROOM_ID, ROOM_NAME, ROOM_PRICE, ROOM_DESC, ROOM_IMG_URL
        FROM
            room
        ORDER BY ROOM_ID
        LIMIT 3
    </select>
    <select id="selectRoomInfo" resultType="com.tuk.hors.room.DTO.RoomDTO">
        SELECT
            ROOM_ID, ROOM_NAME, ROOM_PRICE, ROOM_DESC, ROOM_IMG_URL
            <if test='userCode != null and userCode != ""'>
                ,IF(EXISTS(SELECT * FROM reservation WHERE ROOM_ID = r.ROOM_ID AND USER_CODE = #{userCode}), 'Y', 'N') AS RESERVATION_YN
            </if>
        FROM
            room r
        WHERE
            ROOM_ID = #{roomId}
    </select>
    <select id="selectRandomRoomInfo" resultType="com.tuk.hors.room.DTO.RoomDTO">
        SELECT
            ROOM_ID, ROOM_NAME, ROOM_PRICE, ROOM_DESC, ROOM_IMG_URL
        FROM
            room r
        WHERE
            ROOM_ID != #{roomId}
        ORDER BY RAND()
        LIMIT 1
    </select>
    <insert id="insertReservation">
        INSERT INTO reservation(
            ROOM_ID, USER_CODE
        ) VALUES (
            #{roomId}, #{userCode}
        )
    </insert>
    <delete id="deleteReservation">
        DELETE FROM reservation
        WHERE
            ROOM_ID = #{roomId}
            AND USER_CODE = #{userCode}
    </delete>
</mapper>